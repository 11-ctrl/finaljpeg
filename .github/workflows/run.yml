name: build-and-run

on:
  push:
  pull_request:

jobs:
  run:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Download test image (Kimberly.bmp)
      run: |
        curl -L -o Kimberly.bmp https://raw.githubusercontent.com/cychiang-ntpu/mmsp-2025-final-jpeg/main/Kimberly.bmp

    - name: Build encoder and decoder
      run: |
        make

    - name: Run encoder mode 0
      run: |
        ./encoder 0 Kimberly.bmp R.txt G.txt B.txt dim.txt

    - name: Run encoder mode 1
      run: |
        ./encoder 1 Kimberly.bmp Y.txt Cb.txt Cr.txt dim.txt

    - name: Run decoder mode 1
      run: |
        ./decoder 1 Y.txt Cb.txt Cr.txt out.bmp dim.txt

    - name: List generated files
      run: |
        ls -lh
